<html><head><link rel="stylesheet" href="slurm-guide-styles.css"></head><body><h1 id="guide-to-using-slurm">Slurm User Guide</h1>
<h2 id="writing-slurm-job-scripts">More on writing Slurm Job Scripts</h2>
<p>A Slurm job script is a shell script (typically bash) that contains both Slurm directives and the commands you want to run on the cluster. Let&#39;s break down the components and syntax of a Slurm job script:</p>
<h3 id="basic-structure">Basic Structure</h3>
<pre><code class="lang-bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="code">#SBATCH [options]</span>
<span class="code">#SBATCH [more options]</span>

<span class="code"># Your commands here</span>
</code></pre>
<h3 id="shebang">Shebang</h3>
<p>The first line of your script should be the shebang:</p>
<pre><code class="lang-bash"><span class="hljs-meta">#!/bin/bash</span>
</code></pre>
<p>This tells the system to interpret the script using the bash shell.</p>
<h3 id="slurm-directives">Slurm Directives</h3>
<p>Slurm directives are special comments that start with <code>#SBATCH</code>. They tell Slurm how to set up and run your job. Here are some common directives:</p>
<pre><code class="lang-bash">#SBATCH --job-name=my_job        # Name <span class="hljs-keyword">of</span> the job
#SBATCH --output=output_%j.log   # Standard output log file (%j is replaced by the job ID)
#SBATCH --error=error_%j.log     # Standard error log file
#SBATCH --time=<span class="hljs-number">01</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>          # Time limit (HH:MM:SS)
#SBATCH --ntasks=<span class="hljs-number">1</span>               # Number <span class="hljs-keyword">of</span> tasks (processes)
#SBATCH --cpus-per-task=<span class="hljs-number">1</span>        # Number <span class="hljs-keyword">of</span> CPU cores per task
#SBATCH --mem=<span class="hljs-number">1</span>G                 # Memory limit
#SBATCH --partition=general      # Partition (queue) name
</code></pre>
<h3 id="common-slurm-directives">Common Slurm Directives</h3>
<p>Here&#39;s a more comprehensive list of Slurm directives:</p>
<ul>
<li><code>--job-name=&lt;name&gt;</code>: Set a name for the job</li>
<li><code>--output=&lt;filename&gt;</code>: Specify the file for standard output</li>
<li><code>--error=&lt;filename&gt;</code>: Specify the file for standard error</li>
<li><code>--time=&lt;time&gt;</code>: Set a time limit for the job (format: DD-HH:MM:SS)</li>
<li><code>--ntasks=&lt;number&gt;</code>: Specify the number of tasks to run</li>
<li><code>--cpus-per-task=&lt;number&gt;</code>: Set the number of CPU cores per task</li>
<li><code>--mem=&lt;size[units]&gt;</code>: Set the total memory required (e.g., 1G for 1 gigabyte)</li>
<li><code>--partition=&lt;partition_name&gt;</code>: Specify the partition to run the job on</li>
<li><code>--array=&lt;indexes&gt;</code>: Create a job array (e.g., --array=1-10 for 10 array jobs)</li>
<li><code>--mail-type=&lt;type&gt;</code>: Specify email notification events (e.g., BEGIN, END, FAIL)</li>
<li><code>--mail-user=&lt;email_address&gt;</code>: Set the email address for notifications</li>
<li><code>--nodes=&lt;number&gt;</code>: Request a specific number of nodes</li>
<li><code>--gres=&lt;resource&gt;</code>: Request generic consumable resources (e.g., GPUs)</li>
</ul>
<h3 id="environment-variables">Environment Variables</h3>
<p>Slurm sets several environment variables that you can use in your script:</p>
<ul>
<li><code>$SLURM_JOB_ID</code>: The ID of the job</li>
<li><code>$SLURM_ARRAY_TASK_ID</code>: The array index for job arrays</li>
<li><code>$SLURM_CPUS_PER_TASK</code>: Number of CPUs allocated per task</li>
<li><code>$SLURM_NTASKS</code>: Total number of tasks in a job</li>
</ul>
<h3 id="example-job-script">Example Job Script</h3>
<p>Here&#39;s an example of a more complex Slurm job script:</p>
<pre><code class="lang-bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="code">#SBATCH --job-name=complex_job</span>
<span class="code">#SBATCH --output=output_%A_%a.log</span>
<span class="code">#SBATCH --error=error_%A_%a.log</span>
<span class="code">#SBATCH --array=1-5</span>
<span class="code">#SBATCH --time=02:00:00</span>
<span class="code">#SBATCH --ntasks=1</span>
<span class="code">#SBATCH --cpus-per-task=4</span>
<span class="code">#SBATCH --mem=8G</span>
<span class="code">#SBATCH --partition=general</span>
<span class="code">#SBATCH --mail-type=BEGIN,END,FAIL</span>
<span class="code">#SBATCH --mail-user=your.email@example.com</span>

<span class="code"># Load any necessary modules</span>
module load python/3.8

<span class="code"># Set up the environment</span>
<span class="hljs-built_in">export</span> OMP_NUM_THREADS=<span class="hljs-variable">$SLURM_CPUS_PER_TASK</span>

<span class="code"># Run the main command</span>
python my_script.py --input-file input_<span class="hljs-variable">${SLURM_ARRAY_TASK_ID}</span>.txt --output-file output_<span class="hljs-variable">${SLURM_ARRAY_TASK_ID}</span>.txt

<span class="code"># Optional: Run some post-processing</span>
<span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Job completed successfully"</span>
    python post_process.py output_<span class="hljs-variable">${SLURM_ARRAY_TASK_ID}</span>.txt
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Job failed"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<p>This script sets up a job array with 5 tasks, each using 4 CPU cores and 8GB of memory. It loads a Python module, sets an environment variable, runs a Python script with task-specific input and output files, and then conditionally runs a post-processing step.</p>
<h3 id="best-practices-for-job-scripts">Best Practices for Job Scripts</h3>
<ol>
<li><strong>Use variables</strong>: For repeated values or for clarity, use shell variables.</li>
<li><strong>Comment your script</strong>: Explain complex parts of your script for better maintainability.</li>
<li><strong>Error handling</strong>: Include error checking and handling in your script.</li>
<li><strong>Modularity</strong>: For complex workflows, consider breaking your job into multiple scripts.</li>
<li><strong>Resource estimation</strong>: Start with conservative resource estimates and adjust based on actual usage.</li>
<li><strong>Environment setup</strong>: Load necessary modules and set environment variables at the beginning of your script.</li>
<li><strong>Output management</strong>: Use job ID and array ID in output file names to avoid overwrites.</li>
</ol>
</body></html>